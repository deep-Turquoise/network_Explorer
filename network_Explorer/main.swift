//  main.swift

import Foundation

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Output

func outputToText(giv: String, file_Name: String)
{
    var file = file_Name + ".txt"
    
    do{
        try giv.write(toFile: file, atomically: true, encoding: String.Encoding.utf8 )
    } catch{
        print("Problem outputting to file at function outputToText")
    }
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// String Manipulation

func build_Str(org: String, giv: String) -> String
{
    let new_Str = org + giv + "/"
    return new_Str
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// File Examiniation

func file_Size(cur_Long_Path: String) -> UInt64
{
    var fileSizeNumber = UInt64()
    var path : String = cur_Long_Path
    
    path.remove(at: path.index(before: path.endIndex))
    
    if let fileAttributes = try? FileManager.default.attributesOfItem(atPath: path)
    {
        fileSizeNumber = fileAttributes[FileAttributeKey.size] as! UInt64
    } else {
        print("no good - at function file_Size: common fix is to see if there is a dash at the end of the path")
    }
    
    return fileSizeNumber
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Exploration

func new_Loop_Through(path: String, tab_Depth: Int, file: String, bytes: inout UInt64) -> String {
    var container = String()
    var temp = String()
    var bytes = UInt64()
    
    if(tab_Depth != 0) {for _ in 0 ... tab_Depth{container += "\t"}}
    container += file
    
    if let manager = try? FileManager.default.contentsOfDirectory(atPath: path) {
        for index in manager {
            // hitting a folder here
            temp = new_Loop_Through(path: build_Str(org: path, giv: index), tab_Depth: tab_Depth+1, file: index, bytes: &bytes)
        }
    } else {
        bytes += file_Size(cur_Long_Path: path)
        
        
        //        var filename = file as NSString
        //        var pathExtention = filename.pathExtension
        //
        //        print(filename)
        //        print(pathExtention)
        //        print("-------------------")
    }
    
    container += "\t(Bytes: \(bytes))"
    container += "\n"
    container += temp
    
    return container
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Main

func main()
{
    // starting out at volumes... down the road I may add some sort of user input.
    // this is easiest for blunt force testing
    
    var path: String = "/Volumes/"
    
    // attempt to connect to path and then begin doing work
    if let manager = try? FileManager.default.contentsOfDirectory(atPath: path) {
        for index in manager {
            var bytes2: UInt64 = 0
            
            // if index != "Apple SSD" {
                print("Started looking at: \(index)")
            
                outputToText(giv: new_Loop_Through(path: path + index + "/", tab_Depth: 0, file: index + "/", bytes: &bytes2), file_Name: index)
            
                print("Completed looking at: \(index) \n")
            // }
            
        } // END for
    } else {
        print("seems like something went wrong at the main function when attepmting to call the path at volumes")
    } // END else
} // END main

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Declarations

main()
